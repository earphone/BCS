<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
        <meta name="viewport" content="width=device-width, initial-scale=1"> 
        <meta name="description" content=""> 
        <meta name="author" content=""> 
        <title>BCS Webapp DPR</title>         
        <!-- Bootstrap Core CSS -->         
        <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> 
        <!-- MetisMenu CSS -->         
        <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet"> 
        <!-- Custom CSS -->         
        <link href="../dist/css/sb-admin-2.css" rel="stylesheet"> 
        <!-- Custom Fonts -->         
        <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"> 
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->         
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->         
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->         
    </head>     
    <body onload="checkUser()"> 
        <div id="wrapper"> 
            <!-- Navigation -->             
            <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0"> 
                <div class="navbar-header"> 
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> 
                        <span class="sr-only">Toggle navigation</span> 
                        <span class="icon-bar"></span> 
                        <span class="icon-bar"></span> 
                        <span class="icon-bar"></span> 
                    </button>                     
                    <a class="navbar-brand" href="index.html"><b>BCS Webapp</b></a> 
                </div>                 
                <!-- /.navbar-header -->                 
                <!-- /.navbar-top-links -->                 
                <div class="navbar-default sidebar" role="navigation"> 
                    <div class="sidebar-nav navbar-collapse"> 
                        <ul class="nav" id="side-menu"> 
                            <li> 
                                <a href="index.html"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a> 
                            </li>                             
                            <li> 
                                <a href="dpr.html"><i class="fa fa-list-alt fa-fw"></i> DPR</a> 
                            </li>                             
                            <li> 
                                <a href="dtr.html"><i class="fa fa-list fa-fw"></i> DTR</a> 
                            </li>                             
                            <li> 
                                <a href="profile.html"><i class="fa fa-user fa-fw"></i>&nbsp;Profile</a> 
                            </li>                             
                            <li> 
                                <a href="admin.html"><i class="fa fa-gamepad fa-fw"></i> Admin</a> 
                            </li>                             
                            <!-- fa-institution -->                             
                            <li> 
                                <a href="login.html" onclick="logoutUser()" id="logout"><i class="fa fa-sign-out fa-fw"></i> Logout</a> 
                            </li>                             
                        </ul>                         
                    </div>                     
                    <!-- /.sidebar-collapse -->                     
                </div>                 
                <!-- /.navbar-static-side -->                 
            </nav>             
            <!-- Page Content -->             
            <div id="page-wrapper"> 
                <div class="container-fluid"> 
                    <div class="row"> 
                        <div class="col-lg-12"> 
                            <h1 class="page-header">Daily Progress Report</h1> 
                        </div>                         
                        <!-- /.col-lg-12 -->                         
                    </div>                     
                    <!-- /.row -->                     
                </div>                 
                <!-- /.container-fluid -->                 
                <div> 
                    <h3><i class="fa fa-edit fa-fw"></i>Please Fill out the Information Below for a DPR!</h3> 
                    <div class="form-group"> 
                        <label class="control-label">JOB NUMBER</label>                         
                        <input class="form-control" placeholder="xx-xxx" name="job-num" type="text" value="" id="job-num"> 
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">JOB NAME</label>                         
                        <input class="form-control" placeholder="Job Name" name="job-name" type="text" value="" id="job-name"> 
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">DATE</label>                         
                        <br> 
                        <input class="form-control" type="date" name="dpr-date" id="dpr-date" min="2016-01-01"> 
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">CONTRACTOR</label>                         
                        <input class="form-control" placeholder="Contractor" name="contractor" type="text" value="" id="contractor"> 
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">START TIME</label>                         
                        <input class="form-control" name="time-start" type="text" value="" id="time-start" placeholder="0000"> 
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">END TIME</label>                         
                        <input class="form-control" name="time-end" type="text" value="" id="time-end" placeholder="2400"> 
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">FOREMAN</label>                         
                        <input class="form-control" name="foreman" type="text" value="" id="foreman" placeholder="First Last"> 
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">TECHNICIANS</label>                         
                        <select class="form-control" name="techs" type="select" multiple value="" id="techs" placeholder="First Last"></select>                         
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">INSTALLATION ISSUES / QUESTIONS / REMARKS</label>                         
                        <input class="form-control" placeholder="ANY ISSUES SHOULD BE REPORTED IMMEDIATELY BY PHONE ALSO" name="iqr" type="text" value="" id="iqr"> 
                    </div>                     
                    <div class="row">
                        <div class="form-group col-xs-8"> 
                            <label class="control-label">MATERIAL / EQUIPMENT NEEDED (NOTIFY PM ASAP)</label>                             
                            <input class="form-control" placeholder="Material Needed" name="materials-needed" type="text" value="" id="materials-needed"> 
                        </div>                         
                        <div class="form-group col-xs-4"> 
                            <label class="control-label">DATE NEEDED BY</label>                             
                            <input class="form-control" type="date" name="materials-by" id="materials-by" min="2016-01-01"> 
                        </div>                         
                    </div>                     
                    <div class="row">
                        <div class="form-group" id="work">
                            <div class="form-group col-xs-8"> 
                                <label class="control-label">WORK PERFORMED</label>                                 
                                <input class="form-control" placeholder="Work Done" name="work-done" type="text" value="" id="work-done"> 
                            </div>                             
                            <div class="form-group col-xs-4"> 
                                <label class="control-label">LOCATION (IDF# OR FLOOR)</label>                                 
                                <input class="form-control" type="text" placeholder="Location" name="work-location" id="work-location"> 
                            </div>                             
                        </div>                         
                    </div>                     
                    <div>
                        <button type="button" class="btn btn-sm btn-success" id="work-more" onclick="workMore()">More Work Done?</button>                         
                    </div>
                    <div class="form-group"> 
                        <label class="control-label">COMPANY</label>                         
                        <input class="form-control" placeholder="Company (BCS/AKAMAI)" name="company" type="text" value="" id="company"> 
                    </div>                     
                    <div class="form-group"> 
                        <label class="control-label">Class</label>                         
                        <p></p> 
                        <label class="checkbox-inline"> 
                            <input class="control-label" type="checkbox" value="" id="journeyman">        Journeyman
                        </label>                         
                        <label class="checkbox-inline"> 
                            <input class="control-label" type="checkbox" value="" id="apprentice">        Apprentice
                        </label>                         
                    </div>                     
                    <div class="form-group"> 
                        <input class="form-control" placeholder="Step (Enter 0 for none)" name="company" type="number" value id="apprentice-step"> 
                    </div>                     
                    <p><button type="button" class="btn btn-lg btn-success" id="update-button" onclick="updateData()">Update!</button></p> 
                </div>                 
            </div>             
            <!-- /#page-wrapper -->             
        </div>         
        <!-- /#wrapper -->         
        <!-- Firebase Initialization -->         
        <script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>         
        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyA55RJ8kvG-n-UClBQSNjnjLK3dvb1vwd8",
                authDomain: "bcs-webapp.firebaseapp.com",
                databaseURL: "https://bcs-webapp.firebaseio.com",
                storageBucket: "bcs-webapp.appspot.com",
                messagingSenderId: "664106049370"
            };
            firebase.initializeApp(config);
        </script>         
        <!-- Firebase Create User -->         
        <script>
        function logoutUser() {
            firebase.auth().signOut().then(function() {
              console.log('Signed Out');
            }, function(error) {
              console.error('Sign Out Error', error);
            });
        }
        </script>         
        <!-- Checks if user is logged in. If not,  redirects to Login page -->         
        <script>
        function checkUser() {
            console.log("Checking User!");
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    console.log(user.uid + " is signed in");
                    // User is signed in.
                    // Display the name of the person submitting this form as the foreman
                    document.getElementById("foreman").value = user.displayName;
                    // Fill in Technicians list of all techs
                    var techList = document.getElementById("techs");
                    var query = firebase.database().ref("employees/technicians/").orderByKey();
                    query.once("value")
                    	.then(function(snapshot) {
                        	snapshot.forEach(function(childSnapshot) {
                            	var key = childSnapshot.val().name;
                                var option = document.createElement("option");
                                option.text = key;
                                console.log("adding tech: " + key);
                                techList.add(option);
                        	});
                    	});
                } else {
                    // No user is signed in.
                    window.location="login.html";
                }
            });
        }
        </script>         
        <script>
        function updateData() {
            var jobNum = document.getElementById("job-num").value;
            var jobName = document.getElementById("job-name").value;
            var date = document.getElementById("dpr-date").value;
            var contractor = document.getElementById("contractor").value;
            var timeStart = document.getElementById("time-start").value;
            var timeEnd = document.getElementById("time-end").value;
            var foreman = document.getElementById("foreman").value;
            var techs = document.getElementById("techs").options;
            var techList = "";
            var user = firebase.auth().currentUser;
            console.log(techs[0].selected + " and " + techs[1].selected + " of length " + techs.length);
            var newDPR = firebase.database().ref('dpr').child("randomId").push();
            console.log("newDPR: " + newDPR);
            var newDPRKey = newDPR.key;
            for(i=0; i<techs.length;i++) {
                if(techs[i].selected) {
                	techList=techList + techs[i].value  + "~";  
                }
            }
            // Set data for short DPR by Job #
            firebase.database().ref('dpr/jobNum/' + jobNum + "/" + date).set({
                submittedBy: user.displayName,
                userID: user.uid,
                randomID: newDPRKey
            });
            // Set data for short DPR by Date
			firebase.database().ref('dpr/date/' + date + "/" + jobNum).set({
                submittedBy: user.displayName,
                userID: user.uid,
                randomID: newDPRKey
            });
            // Set data for long DPR
            newDPR.set({
                jobNum: jobNum,
                jobName: jobName,
                date: date,
                contractor: contractor,
                timeStart: timeStart,
                timeEnd: timeEnd,
                foreman: foreman,
                techs: techList
            })
            .then(function() {
                // If set correctly
                alert("Data Updated Successfully!");
                location.reload();
            })
            .catch(function(error) {
                alert("Something Happened when setting details: " + error.message);
            })
        }            
        </script>         
        <script>
        function workMore() {
            var input = document.createElement("input");
            input.type = "text";
            input.className = "form-control";
            container.appendChild(document.getElementById(
        }
        </script>
        <!-- jQuery -->         
        <script src="../vendor/jquery/jquery.min.js"></script>         
        <!-- Bootstrap Core JavaScript -->         
        <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>         
        <!-- Metis Menu Plugin JavaScript -->         
        <script src="../vendor/metisMenu/metisMenu.min.js"></script>         
        <!-- Custom Theme JavaScript -->         
        <script src="../dist/js/sb-admin-2.js"></script>         
    </body>
