<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
        <meta name="viewport" content="width=device-width, initial-scale=1"> 
        <meta name="description" content=""> 
        <meta name="author" content=""> 
        <title>BCS Webapp Admin</title>         
        <!-- Bootstrap Core CSS -->         
        <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> 
        <!-- MetisMenu CSS -->         
        <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet"> 
        <!-- Custom CSS -->         
        <link href="../dist/css/sb-admin-2.css" rel="stylesheet"> 
        <!-- Custom Fonts -->         
        <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"> 
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->         
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->         
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->         
    </head>     
    <body onload="checkUser()"> 
        <div id="wrapper"> 
            <!-- Navigation -->             
            <!-- Page Content -->             
            <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0"> 
                <div class="navbar-header"> 
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> 
                        <span class="sr-only">Toggle navigation</span> 
                        <span class="icon-bar"></span> 
                        <span class="icon-bar"></span> 
                        <span class="icon-bar"></span> 
                    </button>                     
                    <a class="navbar-brand" href="index.html"><b>BCS Webapp</b></a> 
                </div>                 
                <!-- /.navbar-header -->                 
                <!-- /.navbar-top-links -->                 
                <div class="navbar-default sidebar" role="navigation"> 
                    <div class="sidebar-nav navbar-collapse"> 
                        <ul class="nav" id="side-menu"> 
                            <li> 
                                <a href="index.html"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a> 
                            </li>                             
                            <li> 
                                <a href="dpr.html"><i class="fa fa-list-alt fa-fw"></i> DPR</a> 
                            </li>                             
                            <li> 
                                <a href="dtr.html"><i class="fa fa-list fa-fw"></i> DTR</a> 
                            </li>                             
                            <li> 
                                <a href="profile.html"><i class="fa fa-user fa-fw"></i>&nbsp;Profile</a> 
                            </li>                             
                            <li> 
                                <a href="admin.html"><i class="fa fa-gamepad fa-fw"></i> Admin</a> 
                            </li>                             
                            <!-- fa-institution -->                             
                            <li> 
                                <a href="login.html" id="logout" onclick="logoutUser()"><i class="fa fa-sign-out fa-fw"></i> Logout</a> 
                            </li>                             
                        </ul>                         
                    </div>                     
                    <!-- /.sidebar-collapse -->                     
                </div>                 
                <!-- /.navbar-static-side -->                 
            </nav>             
            <div id="page-wrapper"> 
                <div class="container-fluid"> 
                    <div class="row"> 
                        <div class="col-lg-12"> 
                            <h1 class="page-header">Admin</h1> 
                            <p><button type="button" class="btn btn-primary btn-lg btn-block" onclick="listDPR()">View DPRs</button></p> 
                            <p><button type="button" class="btn btn-primary btn-lg btn-block" onclick="listDTR()">View DTRs</button></p> 
                            <p><button type="button" class="btn btn-primary btn-lg btn-block" onclick="listEmployees()">View Employees</button></p> 
                            <hr> 
                        </div>                         
                        <!-- /.col-lg-12 -->                         
                    </div>                     
                    <!-- /.row -->                     
                    <div class="row"> 
                        <div class="col-lg-12" id="data-view"> 
</div>                         
                    </div>                     
                    <hr> 
                    <div class="row"> 
                        <div class="col-lg-12" id="data-list"> 
</div>                         
                    </div>                     
                </div>                 
                <!-- /.container-fluid -->                 
            </div>             
            <!-- /#page-wrapper -->             
        </div>         
        <!-- /#wrapper -->         
        <!-- Firebase Initialization -->         
        <script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>         
        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyA55RJ8kvG-n-UClBQSNjnjLK3dvb1vwd8",
                authDomain: "bcs-webapp.firebaseapp.com",
                databaseURL: "https://bcs-webapp.firebaseio.com",
                storageBucket: "bcs-webapp.appspot.com",
                messagingSenderId: "664106049370"
            };
            firebase.initializeApp(config);
        </script>         
        <!-- Firebase Create User -->         
        <script>
        function logoutUser() {
            firebase.auth().signOut().then(function() {
              console.log('Signed Out');
            }, function(error) {
              console.error('Sign Out Error', error);
            });
        }
        </script>         
        <!-- Checks if user is logged in. If not,  redirects to Login page -->         
        <script>
        function checkUser() {
            console.log("Checking User!");
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    console.log(user.uid + " is signed in");
                    // User is signed in.
                } else {
                    // No user is signed in.
                    window.location="login.html";
                }
            });
        }
        </script>         
        <script>
        function listDPR() {
            // Clear list and view divs
            var dataList = document.getElementById("data-list");
            var dataView = document.getElementById("data-view");
            var dprRef = firebase.database().ref("/employees/employed/" + user.uid + "/history/dpr");
            dataList.innerHTML = "";
            dataView.innerHTML = "";
        }
        </script>         
        <script>
        function listDTR() {
            // Clear list and view divs
            var dataList = document.getElementById("data-list");
            var dataView = document.getElementById("data-view");
            var dtrRef = firebase.database().ref("dtr/date");
            dataList.innerHTML = "";
            dataView.innerHTML = ""; 
            // Start DTR (This is on top so that the DPR stuff can be placed after)
            dtrRef.orderByKey().limitToLast(20).on("child_added", function(snapshot) {
                console.log(snapshot.key);
                var randomId = "";
                var dtrElement = document.createElement("a");
                var date = snapshot.key;
                var jobNum;
                var submittedBy;
                snapshot.forEach(function(childSnapshot) {
                    jobNum = childSnapshot.key;
                    childSnapshot.forEach(function(grandchildSnapshot) {
                        randomId = grandchildSnapshot.key;
                        submittedBy = grandchildSnapshot.val().submittedBy;
                        console.log(jobNum + " " + randomId);
                    });
                });
                date = date.replace("-","").replace("-","");
                dtrElement.href = "javascript:void(0)";
                dtrElement.onclick = function showData() {
                    // Load data for this specific randomId
                    firebase.database().ref('dtr/randomId/' + randomId).once('value').then(function(snapshot) {
                        // ...
                        console.log(snapshot.ref.toString());
                        var headerElement = document.createElement("h2");
                        var byLabelElement = document.createElement("h3");
                        var byElement = document.createElement("input");
                        var performedLabelElement = document.createElement("h3");
                        var performedTopHintElement = document.createElement("h5");
                        var performedBotHintElement = document.createElement("h5");
                        var iqrLabelElement = document.createElement("h3");
                        var iqrElement = document.createElement("input");
                        //var dataElement = document.createElement("a");
                        // Header data (needs buttons for edit/delete)
                        headerElement.textContent = snapshot.val().type + " DTR for Job #" + snapshot.val().jobNum + " on " + snapshot.val().date + " from " + snapshot.val().timeStart + " to " + snapshot.val().timeEnd + " or " + snapshot.val().timeTotal + " total hours";
                        dataView.append(headerElement);
                        dataView.append(document.createElement("hr"));
                        // Display submitted by
                        byLabelElement.textContent = "SUBMITTED BY:";
                        byLabelElement.style.textDecoration = "underline";
                        dataView.append(byLabelElement);
                        byElement.readOnly = "true";
                        byElement.id = "by-element";
                        byElement.className = "form-control";
                        byElement.value = snapshot.val().submittedBy;
                        dataView.append(byElement);
                        // Display work performed
                        performedLabelElement.textContent = "WORK PERFORMED:";
                        performedLabelElement.style.textDecoration = "underline";
                        dataView.append(performedLabelElement);
                        performedTopHintElement.textContent = "WORK PERFORMED: COST-CODE";
                        dataView.append(performedTopHintElement);
                        performedBotHintElement.textContent = "HOURS - MATERIALS ISSUED - MATERIALS INSTALLED";
                        dataView.append(performedBotHintElement);
                        // ISP Data
                        if(snapshot.val().type == "ISP") {
                            var fieldsList = [
                                ["PATHWAYS AND SPACES:",""],["INSTALL CEILING HANGER","3-001"],["INSTALL J-HOOK","3-001"],
                                ["INSTALL SLEEVE (DRYWALL)","3-001"],["INSTALL SLEEVE (CONCRETE)","3-001"],["INSTALL CONDUIT","3-001"],
                                ["INSTALL CABLE RUNWAY/TRAY","3-001"],["MDF/IDF WORK:",""],["INSTALL BACKBOARD","4-001"],
                                ["INSTALL CABLE RUNWAY/TRAY","4-002"],["INSTALL GROUND WIRE","4-002"],["INSTALL RACK/CABINET","4-003"],
                                ["IDF EQUIPMENT MOUNTING","4-003"],["INSTALL GROUND WIRE","4-003"],["IDF HORIZ CABLE DRESSING","4-004"],
                                ["IDF HORIZ CABLE TERMINATIONS","4-004"],["IDF LABELING","4-005"],["RISERS:",""],
                                ["RISER CABLE ROUGH IN","5-001"],["RISER CABLE DRESSING","5-001"],["RISER CABLE TERMINATIONS","4-004"],
                                ["HORIZONTAL WORK:",""],["IDF TESTING","4-005"],["INSTALL PULL STRING","6-X0X/7-00X"],
                                ["CABLE ROUGH-IN","6-X0X/7-00X"],["FISH WALL","6-X0X/7-00X"],["INSTALL MPLS","6-X0X/7-00X"],
                                ["INSTALL WIREMOLD","6-X0X/7-00X"],["TERMINATE JACKS","6-X0X/7-00X"],["INSTALL FACEPLATES","6-X0X/7-00X"],
                                ["TESTING","6-X0X/7-00X"],["INDIRECT LABOR COSTS:",""],["PUNCHLIST","8-006"],
                                ["TROUBLESHOOTING","8-006"],["MATERIAL HANDLING","8-007"],["DEMO:",""],
                                ["ISP DEMO","11-001"],["RISER DEMO","11-003"]
                            ];
                            // use switch, print out 0,7,17,21,32,36
                            for(var i = 0; i < 38; i++) {
                                switch(i) {
                                    case 0:
                                    case 7:
                                    case 17:
                                    case 21:
                                    case 31:
                                    case 35:
                                        var tempElement = document.createElement("h4");
                                        tempElement.textContent = fieldsList[i][0];
                                        tempElement.style.textDecoration = "underline";
                                        dataView.append(tempElement);
                                        break
                                        default:
                                        //console.log(childSnapshot.val()[i] + " i: " + i);
                                        if(snapshot.val().hours[i] != "") {
                                            var tempLabel = document.createElement("h5");
                                            var tempElement = document.createElement("input");
                                            tempLabel.textContent = fieldsList[i][0] + ": " + fieldsList[i][1];
                                            tempElement.readOnly = "true";
                                            tempElement.id = "performed-element-" + i;
                                            tempElement.className = "form-control";	
                                            tempElement.value = snapshot.val().hours[i] + " - " + snapshot.val().matIssued[i] + " - " + snapshot.val().matinstalled[i];
                                            dataView.append(tempLabel);
                                            dataView.append(tempElement);
                                        }
                                }
                            }
                        }
                        // OSP Data
                        else if(snapshot.val().type == "OSP") {
                            var fieldsList = [
                                ["OSP (Including Site Work):",""],["MAINTENANCE HOLE SETUP","2-001"],["ROD AND ROPE","2-001"],
                                ["INSTALL INNDERDUCT","2-001"],["INSTALL CABLE","2-001"],["MAINTENANCE HOLE/OUTDOOR WORK:",""],
                                ["DRESS CABLES","2-002"],["INSTALL DUCT SEAL","2-002"],["INSTALL TERMINATION BAGS","2-002"],
                                ["INSTALL LABELING","2-002"],["SPLICING WORK","2-002"],["MOUNT EQUIPMENT","2-002"],
                                ["TERMINATIONS","2-002"],["TESTING","2-002"],["MAINTENANCE HOLE GUARD","2-001"],
                                ["TRAFFIC CONTROL","2-001"],["INDIRECT LABOR COSTS:",""],["PUNCHLIST","8-006"],
                                ["TROUBLESHOOTING","8-006"],["MATERIAL HANDLING","8-007"],["DEMO:",""],["OSP DEMO","11-002"]
                            ];
                            for(var i = 0; i < 22; i++) {
                                switch(i) {
                                    case 0:
                                    case 5:
                                    case 16:
                                    case 20:
                                        var tempElement = document.createElement("h4");
                                        tempElement.textContent = fieldsList[i][0];
                                        tempElement.style.textDecoration = "underline";
                                        dataView.append(tempElement);
                                        break
                                        default:
                                        if(snapshot.val().hours[i] != "") {
                                            var tempLabel = document.createElement("h4");
                                            var tempElement = document.createElement("input");
                                            tempLabel.textContent = fieldsList[i][0] + ": " + fieldsList[i][1];
                                            tempElement.readOnly = "true";
                                            tempElement.id = "performed-element-" + i;
                                            tempElement.className = "form-control";	
                                            tempElement.value = snapshot.val().hours[i] + " - " + snapshot.val().matIssued[i] + " - " + snapshot.val().matinstalled[i];
                                            dataView.append(tempLabel);
                                            dataView.append(tempElement);
                                        }
                                }
                            }
                        }
                        // Iqr Data
                        iqrLabelElement.textContent = "INSTALLATION ISSUES/QUESTION/REMARKS:";
                        iqrLabelElement.style.textDecoration = "underline";
                        dataView.append(iqrLabelElement);
                        iqrElement.readOnly = "true";
                        iqrElement.id = "iqr-element";
                        iqrElement.className = "form-control";
                        iqrElement.value = snapshot.val().iqr;
                        dataView.append(iqrElement);
                        // Hidden Data with randomId (needs ID to call when going to next page)
                        // Random data
                        //dataElement.className = "list-group-item";
                        //dataElement.text = snapshot.val().date;
                        //dataView.append(dataElement);
                        var buttonsDiv = document.createElement("div");
                        var downloadDiv = document.createElement("div");
                        var deleteDiv = document.createElement("div");
                        var downloadButton = document.createElement("button");
                        var deleteButton = document.createElement("button");
                        downloadDiv.className = "col-xs-6";
                        downloadButton.className = "btn btn-info btn-lg btn-block";
                        downloadButton.innerHTML = "DOWNLOAD!";
                        downloadButton.onclick = dtrDownload(snapshot.val());
                        downloadDiv.append(downloadButton);
                        deleteDiv.className = "col-xs-6";
                        deleteButton.className = "btn btn-danger btn-lg btn-block";
                        deleteButton.innerHTML = "DELETE!!";
                        deleteButton.onclick = dtrDelete(snapshot.val());
                        deleteDiv.append(deleteButton);
                        buttonsDiv.className = "row";
                        buttonsDiv.append(downloadDiv);
                        buttonsDiv.append(deleteDiv);
                        dataView.append(document.createElement("br"));
                        dataView.append(buttonsDiv);
                    });
                }
                //console.log(randomId);
                // Onclick will enact the showData() function for the randomId
                dtrElement.className = "list-group-item";
                dtrElement.text = "DTR_" + jobNum + "_" + date + "_" + submittedBy;
                dataList.insertBefore(dtrElement, dataList.firstChild);
            });
            dtrRef.orderByKey().off("child_added");
            // End DTR
        }
        </script>         
        <script>
        function listEmployees() {
            // Clear list and view divs
            var dataList = document.getElementById("data-list");
            var dataView = document.getElementById("data-view");
            dataList.innerHTML = "";
            dataView.innerHTML = "";
            var query = firebase.database().ref("employees/employed/").orderByChild("nameFull");
                query.once("value")
                    .then(function(snapshot) {
                    snapshot.forEach(function(childSnapshot) {
                        var listEmployee = document.createElement("a");
                        listEmployee.text = childSnapshot.val().nameFull;
                        listEmployee.className = "list-group-item";
                        listEmployee.href = "javascript:void(0)";
                        listEmployee.onclick = function showData() {
                            dataView.innerHTML = "";
                            var dataFirst = childSnapshot.val().nameFirst;
                            var dataLast = childSnapshot.val().nameLast;
                            var dataInitials = childSnapshot.val().initials;
                            var dataID = childSnapshot.val().idNum;
                            var dataCell = childSnapshot.val().cellNum;
                            var dataContact = childSnapshot.val().contactNum;
                            var dataCompany = childSnapshot.val().company;
                            var dataAccess = childSnapshot.val().access;
                            var dataJourneyman = childSnapshot.val().journeyman;
                            var dataApprentice = childSnapshot.val().apprentice;
                            var dataStep = childSnapshot.val().step;
                            for(var i = 0; i<6; i++) {
                                var tempLabel = document.createElement("h4");
                                var tempElement = document.createElement("input");
                                // switch statement to easily set up each field
                                switch(i) {
                                    case 0:
                                		tempLabel.textContent = "First Name";	
                                		tempElement.value = dataFirst;
                                        tempElement.placeHolder = dataFirst;
                                        break
                                    case 1:
                                		tempLabel.textContent = "Last Name";	
                                		tempElement.value = dataLast;
                                        tempElement.placeHolder = dataLast;
                                        break
                                    case 2:
                                		tempLabel.textContent = "Initials";	
                                		tempElement.value = dataInitials;
                                        tempElement.placeHolder = dataInitials;
                                        break
                                    case 3:
                                		tempLabel.textContent = "Employee Id #";	
                                		tempElement.value = dataID;
                                        tempElement.placeHolder = dataID;
                                        break
                                    case 4:
                                		tempLabel.textContent = "Cell #";	
                                		tempElement.value = dataCell;
                                        tempElement.placeHolder = dataCell;
                                        break
                                    case 5:
                                		tempLabel.textContent = "Contact #";	
                                		tempElement.value = dataContact;
                                        tempElement.placeHolder = dataContact;
                                        break
                                    case 6:
                                		tempLabel.textContent = "Company";	
                                		tempElement.value = dataCompany;
                                        tempElement.placeHolder = dataCompany;
                                        break
                                    case 7:
                                    	tempLabel.textContent = "Access Level";
                                		tempElement.value = dataAccess;
                                        tempElement.placeHolder = dataAccess;
                                }
                                tempElement.readOnly = "true";
                                tempElement.id = "performed-element-" + i;
                                tempElement.className = "form-control";
                                dataView.append(tempLabel);
                                dataView.append(tempElement);
                            }
                            var classLabel = document.createElement("h4");
                            // Checkbox for Journeyman
                            var journeymanLabel = document.createElement("label");
                            var journeymanElement = document.createElement("input");
                            var journeymanDescription = document.createTextNode("Journeyman");
                            classLabel.textContent = "Class";
                            journeymanElement.type = "checkbox";
                            journeymanElement.className = "control-label";	
                            journeymanElement.checked = dataJourneyman;
                            journeymanElement.disabled = true;
                            journeymanElement.id = "performed-element-7";
                            journeymanLabel.className = "checkbox-inline";
                            journeymanLabel.append(journeymanElement);
                            journeymanLabel.append(journeymanDescription);
                            dataView.append(classLabel);
                            dataView.append(journeymanLabel);
                            // Checkbox for apprentice
                            var apprenticeLabel = document.createElement("label");
                            var apprenticeElement = document.createElement("input");
                            var apprenticeDescription = document.createTextNode("Apprentice");
                            apprenticeElement.type = "checkbox";
                            apprenticeElement.className = "control-label";
                            console.log("DA: " + dataApprentice);
                            apprenticeElement.checked = dataApprentice;
                            apprenticeElement.disabled = true;
                            apprenticeElement.id = "performed-element-8";
                            apprenticeLabel.className = "checkbox-inline";
                            apprenticeLabel.append(apprenticeElement);
                            apprenticeLabel.append(apprenticeDescription);
                            dataView.append(apprenticeLabel);
                            // Input field for step
                            var stepLabel = document.createElement("h4");
                            var stepElement = document.createElement("input");
                            stepLabel.textContent = "Step";	
                            stepElement.value = dataStep;
                            stepElement.placeHolder = dataStep;
                            stepElement.readOnly = "true";
                            stepElement.id = "performed-element-9";
                            stepElement.className = "form-control";
                            dataView.append(stepLabel);
                            dataView.append(stepElement);
                        }
                        console.log(childSnapshot.val().nameFull);
                        dataList.appendChild(listEmployee);
                    });
                });
        }
        </script>         
        <script>
        function dtrDownload(ref) {
            
        }
        </script>
        <script>
        function dtrDelete(ref) {
            var confirmation = confirm('Are you sure you want to delete this DTR?');
            if(confirmation) {
                alert("successfully deleted");
            }
            else {
                alert("not deleted");
                return
            }
        }
        </script>
        <script>
        // num is the number of date prior to today ex. 0 = today; 1 = yesterday
        function getDate(num) {
            var tempDate =  new Date();
            var date = new Date(tempDate);
            date.setDate(tempDate.getDate()-num);
            year = date.getFullYear();
            month = date.getMonth() + 1;
            if(month < 10) {
            	month = "0" + month;   
            }
            day = date.getDate();
            return year + "-" + month + "-" + day;
        }
        </script>         
        <!-- jQuery -->         
        <script src="../vendor/jquery/jquery.min.js"></script>         
        <!-- Bootstrap Core JavaScript -->         
        <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>         
        <!-- Metis Menu Plugin JavaScript -->         
        <script src="../vendor/metisMenu/metisMenu.min.js"></script>         
        <!-- Custom Theme JavaScript -->         
        <script src="../dist/js/sb-admin-2.js"></script>         
    </body>     
</html>
