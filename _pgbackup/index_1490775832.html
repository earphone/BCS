<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
        <meta name="viewport" content="width=device-width, initial-scale=1"> 
        <meta name="description" content=""> 
        <meta name="author" content=""> 
        <title>BCS Webapp Dashboard</title>         
        <!-- Bootstrap Core CSS -->         
        <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> 
        <!-- MetisMenu CSS -->         
        <link href="vendor/metisMenu/metisMenu.min.css" rel="stylesheet"> 
        <!-- Custom CSS -->         
        <link href="dist/css/sb-admin-2.css" rel="stylesheet"> 
        <!-- Morris Charts CSS -->         
        <link href="vendor/morrisjs/morris.css" rel="stylesheet"> 
        <!-- Custom Fonts -->         
        <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"> 
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->         
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->         
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->         
    </head>     
    <body onload="checkUser()"> 
        <div id="wrapper"> 
            <!-- Navigation -->             
            <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0"> 
                <div class="navbar-header"> 
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> 
                        <span class="sr-only">Toggle navigation</span> 
                        <span class="icon-bar"></span> 
                        <span class="icon-bar"></span> 
                        <span class="icon-bar"></span> 
                    </button>                     
                    <a class="navbar-brand" href="index.html"><b>BCS Webapp</b></a> 
                </div>                 
                <!-- /.navbar-header -->                 
                <!-- /.navbar-top-links -->                 
                <div class="navbar-default sidebar" role="navigation"> 
                    <div class="sidebar-nav navbar-collapse"> 
                        <ul class="nav" id="side-menu"> 
                            <li> 
                                <a href="pages/index.html"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a> 
                            </li>                             
                            <li> 
                                <a href="pages/dpr.html"><i class="fa fa-list-alt fa-fw"></i> DPR</a> 
                            </li>                             
                            <li> 
                                <a href="pages/dtr.html"><i class="fa fa-list fa-fw"></i> DTR</a> 
                            </li>                             
                            <li> 
                                <a href="pages/profile.html"><i class="fa fa-user fa-fw"></i>&nbsp;Profile</a> 
                            </li>                             
                            <li> 
                                <a href="pages/admin.html"><i class="fa fa-gamepad fa-fw"></i> Admin</a> 
                            </li>                             
                            <!-- fa-institution -->                             
                            <li> 
                                <a href="pages/login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a> 
                            </li>                             
                        </ul>                         
                    </div>                     
                    <!-- /.sidebar-collapse -->                     
                </div>                 
                <!-- /.navbar-static-side -->                 
            </nav>             
            <div id="page-wrapper"> 
                <div class="row"> 
                    <div class="col-lg-12"> 
                        <h1 class="page-header" id="dashboard-header">Dashboard</h1> 
                    </div>                     
                    <!-- /.col-lg-12 -->                     
                </div>                 
                <!-- /.row -->                 
                <div class="row"> 
                    <!-- /.col-lg-8 -->                     
                    <div class="col-lg-12"> 
                        <div class="panel panel-default"> 
                            <div class="panel-heading"> 
                                <i class="fa fa-rebel fa-fw"></i> Recent Reports
                            </div>                             
                            <!-- /.panel-heading -->                             
                            <div class="panel-body"> 
                                <div class="list-group" id="list-report"> 
                                    <a href="#" class="list-group-item"><i class="fa fa-comment fa-fw"></i> New Comment<span class="pull-right text-muted small"><em>4 minutes ago</em></span></a> 
                                    <a href="#" class="list-group-item"><i class="fa fa-twitter fa-fw"></i> 3 New Followers<span class="pull-right text-muted small"><em>12 minutes ago</em></span></a> 
                                    <a href="#" class="list-group-item"><i class="fa fa-envelope fa-fw"></i> Message Sent<span class="pull-right text-muted small"><em>27 minutes ago</em></span></a> 
                                    <a href="#" class="list-group-item"><i class="fa fa-tasks fa-fw"></i> New Task<span class="pull-right text-muted small"><em>43 minutes ago</em></span></a> 
                                    <a href="#" class="list-group-item"><i class="fa fa-upload fa-fw"></i> Server Rebooted<span class="pull-right text-muted small"><em>11:32 AM</em></span></a> 
                                    <a href="#" class="list-group-item"><i class="fa fa-bolt fa-fw"></i> Server Crashed!<span class="pull-right text-muted small"><em>11:13 AM</em></span></a> 
                                    <a href="#" class="list-group-item"><i class="fa fa-warning fa-fw"></i> Server Not Responding<span class="pull-right text-muted small"><em>10:57 AM</em></span></a> 
                                    <a href="#" class="list-group-item"><i class="fa fa-shopping-cart fa-fw"></i> New Order Placed<span class="pull-right text-muted small"><em>9:49 AM</em></span></a> 
                                    <a href="#" class="list-group-item"><i class="fa fa-money fa-fw"></i> Payment Received<span class="pull-right text-muted small"><em>Yesterday</em></span></a> 
                                </div>                                 
                                <!-- /.list-group -->                                 
                                <a href="#" class="btn btn-default btn-block">View All Alerts</a> 
                            </div>                             
                            <!-- /.panel-body -->                             
                        </div>                         
                        <!-- /.panel -->                         
                        <div class="panel panel-default"> 
                            <!-- /.panel-body -->                             
                        </div>                         
                        <!-- /.panel -->                         
                        <div class="chat-panel panel panel-default"> 
                            <!-- /.panel-heading -->                             
                            <!-- /.panel-body -->                             
                            <div class="panel-footer"> 
                                <div class="form-group" id="report-data">
                                    <h4><i class="fa fa-beer fa-fw"></i>Data will be down here<i class="fa fa-database fa-fw"></i></h4>
                                </div>                                 
                            </div>                             
                            <!-- /.panel-footer -->                             
                        </div>                         
                        <!-- /.panel .chat-panel -->                         
                    </div>                     
                    <!-- /.col-lg-4 -->                     
                </div>                 
                <!-- /.row -->                 
            </div>             
            <!-- /#page-wrapper -->             
        </div>         
        <!-- Firebase Keys -->         
        <script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>         
        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyA55RJ8kvG-n-UClBQSNjnjLK3dvb1vwd8",
                authDomain: "bcs-webapp.firebaseapp.com",
                databaseURL: "https://bcs-webapp.firebaseio.com",
                storageBucket: "bcs-webapp.appspot.com",
                messagingSenderId: "664106049370"
            };
            firebase.initializeApp(config);
        </script>         
        <script>
        	function checkUser() {
                console.log("Checking User!");
                firebase.auth().onAuthStateChanged(function(user) {
                    if (user) {
                        console.log(user.uid + " is signed in");
                        var initials;
                        var userRef = firebase.database().ref("/employees/employed/" + user.uid);
                        var dprRef = firebase.database().ref("/employees/employed/" + user.uid + "/history/dpr");
                        var dtrRef = firebase.database().ref("/employees/employed/" + user.uid + "/history/dpr");
                        userRef.once("value", function(snapshot) {
                            console.log("User email: " + user.email + " Snapshot: " + snapshot.val().email);
                            console.log(user);
                            snapshot.val().initials;
                            window.document.getElementById('dashboard-header').innerText = "Hello " + user.displayName;
                            // User is signed in.
                    	});
                        // Get data for user's last 14 reports (7 DPR and 7 DTR) and place them in the panel with links to open below
                        console.log("Ordering by key");
                        var listDiv = document.getElementById("list-report");
                        dprRef.orderByKey().limitToLast(8).on("child_added", function(snapshot) {
                            console.log(snapshot.key);
                            var dprElement = document.createElement("a");
                            console.log(snapshot);
                            var date = snapshot.key;
                            var jobNum = snapshot.val().date;
                            date = date.replace("-","").replace("-","");
                            dprElement.className = "list-group-item";
                            dprElement.text = "DPR_" + jobNum + "_" + date + "_" + initials;
                            // Add hidden values here
                            listDiv.appendChild(dprElement);
                        });
                        dprRef.orderByKey().off("child_added");
                    }
                    else {
                        // No user is signed in.
                        window.location="pages/login.html";
                    }
                });
            }
        </script>         
        <script>
        function showData(randomId, type) {
            var dataDiv = document.getElementByID("report-data");
            dataDiv.innerHTML = "";
            firebase.database().ref(type + "/randomId/" + randomId).once('value').then(function(snapshot) {
              var username = snapshot.val().username;
              // ...
            });
        }
        </script>
        <!-- /#wrapper -->         
        <!-- jQuery -->         
        <script src="vendor/jquery/jquery.min.js"></script>         
        <!-- Bootstrap Core JavaScript -->         
        <script src="vendor/bootstrap/js/bootstrap.min.js"></script>         
        <!-- Metis Menu Plugin JavaScript -->         
        <script src="vendor/metisMenu/metisMenu.min.js"></script>         
        <!-- Morris Charts JavaScript -->         
        <script src="vendor/raphael/raphael.min.js"></script>         
        <script src="vendor/morrisjs/morris.min.js"></script>         
        <script src="data/morris-data.js"></script>         
        <!-- Custom Theme JavaScript -->         
        <script src="dist/js/sb-admin-2.js"></script>         
        <script src="js/app.js"></script>         
    </body>     
</html>
